var map;
var cmarkers;
var i =0;
var geocoder;
var infoboxes;
function initialize() {
  geocoder = new google.maps.Geocoder();
  var mylocation = new google.maps.LatLng(22.300,76.580);
  var mapOptions = {center: mylocation, zoom: 7, mapTypeId: google.maps.MapTypeId.ROADMAP};
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  var contentString = 'hiiiiiiiiiiiiiiiiiiiiii';
  var infowindow = new google.maps.InfoWindow({content: contentString});
  var marker = new google.maps.Marker({position: mylocation, map: map, animation: google.maps.Animation.BOUNCE, title: 'Welcome to Jain Muni Locator'});
  
google.maps.event.addListener(marker, 'click', function() {
  marker.setMap(map);
  infowindow.open(map,marker);
  });
  
    google.maps.event.addListener(map, 'click', function(event) {
    //placeMarker(event.latLng);
  });
}

function markerlis(i)
{
 google.maps.event.addListener(cmarkers[i], 'click', function() {
  cmarkers[i].setMap(map);
  infoboxes[i].open(map,cmarkers[i]);
  });
}
  
function placeMarker(location) {
var input = String(location);
input = input.replace("(","");
input = input.replace(")","");
var latlngStr = input.split(',', 2);
  var lat = parseFloat(latlngStr[0]);
  var lng = parseFloat(latlngStr[1]);
  var latlng = new google.maps.LatLng(lat, lng);
   geocoder.geocode({'latLng': latlng}, function(results, status) {
    if (status == google.maps.GeocoderStatus.OK) {
      if (results[1]) {
        cmarkers[i] = new google.maps.Marker({
      position: location,
      map: map,animation: google.maps.Animation.BOUNCE, title: results[1].formatted_address
  });
  
   infoboxes[i] = new google.maps.InfoWindow({content: results[1].formatted_address});
markerlis(i);
  
      } else {
        alert('No results found');
      }
    } else {
      alert('Geocoder failed due to: ' + status);
    }
  });
  
  
  i++;
}
var g = "";
var addx = "";
   var dtd = $.Deferred(); //create a new deferred object
           var wait = function (dtd,addr) {
               var tasks = function () {
               
var geozcoder = new google.maps.Geocoder();
                  geozcoder.geocode( { 'address': addr}, function(results, status) {
       if (status == google.maps.GeocoderStatus.OK) {
       g= (results[0].geometry.location.toString());
             } else {
        g = ("Geocode was not successful for the following reason: " + status);
        setTimeout(function(){},2000);
      }
  

    });
                   dtd.resolve();
               };
               tasks();
               return dtd;
           };

           //test

           function addtolatlng(address) {
               addx = address;
               $.when(wait(dtd,address)).done(function () { alert(g); }).fail(function () { alert("failÔºÅ"); });

           }
google.maps.event.addDomListener(window, 'load', initialize);
